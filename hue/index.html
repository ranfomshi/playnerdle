<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Play Hue and find the odd one out!" />
    <meta
      name="keywords"
      content="colour, colour, game, find, odd, different"
    />
    <meta name="author" content="PlayNerdle" />
    <title>Hue - find the odd one out!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f4f4f4;
        font-family: "Roboto", sans-serif;
        text-align: center;
      }
      .container {
        margin: auto;
        max-width: 600px;
        font-size: 0;
        margin-top: 80px;
      }
      #timer {
        width: 100%;
        height: 20px;
        background-color: #00ff00;
        transition: width 4s linear;
      }
    </style>
  </head>
  <body>
    <div id="navbar-container"></div>
    <div class="container"></div>
    <div id="streakCounter">Streak: <span id="streak">0</span></div>
    <div id="timer"></div>
    <script>
      // Variable to keep track of the streak and timer
      let streak = 0;
      let timer;

      // Update the streak display
      const updateStreakDisplay = () => {
        document.getElementById("streak").textContent = streak;
      };

      // Function to start the timer
      const startTimer = () => {
        clearTimeout(timer);
        const timerElement = document.getElementById("timer");
        timerElement.style.transition = "none"; // Disable transition for instant reset
        timerElement.style.width = "100%"; // Instantly set to 100%
        // Force a reflow to make sure the transition will be applied for the shrinking
        void timerElement.offsetWidth;
        timerElement.style.transition = "width 4s linear"; // Enable transition again
        timerElement.style.width = "0%"; // Start shrinking
        timer = setTimeout(() => {
          alert("Time's up! Game Over!");
          streak = 0;
          updateStreakDisplay();
          initGameBoard();
        }, 4000);
      };

      // Function to initialize a new game board
      const initGameBoard = () => {
        const container = document.querySelector(".container");
        container.innerHTML = ""; // Clear previous squares

        const mainColor = generateColor();
        const oddColor = generateSlightlyDifferentColor(mainColor);
        const oddPosition = Math.floor(Math.random() * 9);

        for (let i = 0; i < 9; i++) {
          const square = document.createElement("div");
          square.style.width = "100px";
          square.style.height = "100px";
          square.style.display = "inline-block";
          square.style.margin = "5px";
          square.style.backgroundColor =
            i === oddPosition ? oddColor : mainColor;
          square.onclick = () => checkSquare(i, oddPosition);
          container.appendChild(square);
        }

        startTimer();
      };

      // Function to generate a random color
      const generateColor = () => {
        const r = Math.floor(Math.random() * 256);
        const g = Math.floor(Math.random() * 256);
        const b = Math.floor(Math.random() * 256);
        return `rgb(${r}, ${g}, ${b})`;
      };

      // Function to generate a slightly different color based on the given color
      const generateSlightlyDifferentColor = (color) => {
        const [r, g, b] = color.match(/\d+/g).map(Number);
        const newR = Math.min(255, r + 10);
        const newG = Math.min(255, g + 10);
        const newB = Math.min(255, b + 10);
        return `rgb(${newR}, ${newG}, ${newB})`;
      };

      // Function to check if the clicked square is the odd one out
      const checkSquare = (index, oddPosition) => {
        if (index === oddPosition) {
          streak++;
          updateStreakDisplay();
          initGameBoard();
        } else {
          alert("Game Over!");
          streak = 0;
          updateStreakDisplay();
          initGameBoard();
        }
      };

      // Disable right-click context menu to prevent easy cheating
      document.addEventListener("contextmenu", (event) => {
        event.preventDefault();
      });

      // Initialize the game board for the first time
      initGameBoard();
    </script>
    <script src="../globalNav/globalNav.js" defer></script>
  </body>
</html>
