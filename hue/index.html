<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Hue - find the odd one out!</title>
  <style>
    body {
      background-color: #f4f4f4;
      font-family: "Roboto", sans-serif;
      text-align: center;
    }

    .container {
      margin: auto;
      max-width: 600px;
      font-size: 0;
      margin-top: 100px;
    }

    #timer {
      width: 100%;
      height: 20px;
      margin-top: 100px;
      background: green;
    }

    #gameOverScreen {
      display: none;
      position: absolute;
      padding-top: 20px;
      top: 40px;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      text-align: center;
      font-size: 32px;
    }
  </style>
</head>

<body>
    <div id="navbar-container"></div>
  <div id="streakCounter">Streak: <span id="streak">0</span></div>
  <div id="timer"></div>
  <div class="container"></div>
  <div id="gameOverScreen">
    Game Over!<br>
    Final Streak: <span id="finalStreak">0</span><br>
    Average Time: <span id="averageTime">0</span>s<br>
    Slowest Time: <span id="slowestTime">0</span>s<br>
    <button id="restartButton">Restart</button>
  </div>

  <script>
    let streak = 0;
    let oddPosition;
    let timer;
    let startTime;
    let roundTimes = [];
    let slowestTime = 0;

    const updateStreakDisplay = () => {
      document.getElementById("streak").textContent = streak;
    };

    const generateColor = () => {
      const r = Math.floor(Math.random() * 256);
      const g = Math.floor(Math.random() * 256);
      const b = Math.floor(Math.random() * 256);
      return `rgb(${r}, ${g}, ${b})`;
    };

    const generateSlightlyDifferentColor = (color) => {
      const [r, g, b] = color.match(/\d+/g).map(Number);
      const newR = Math.min(255, r + 10);
      const newG = Math.min(255, g + 10);
      const newB = Math.min(255, b + 10);
      return `rgb(${newR}, ${newG}, ${newB})`;
    };

    const startTimer = () => {
      const timerElement = document.getElementById('timer');
      let width = 100;
      timerElement.style.width = `${width}%`;

      clearInterval(timer);
      timer = setInterval(() => {
        width -= 1;
        timerElement.style.width = `${width}%`;
        if (width <= 0) {
          clearInterval(timer);
          showGameOver();
        }
      }, 40);
    };

    const calculateAverageTime = () => {
      
      const total = roundTimes.reduce((acc, val) => acc + val, 0);
      return (total / roundTimes.length).toFixed(2);
    };

    const initGameBoard = () => {
      const container = document.querySelector('.container');
      container.innerHTML = '';
      const mainColor = generateColor();
      const oddColor = generateSlightlyDifferentColor(mainColor);
      oddPosition = Math.floor(Math.random() * 9);

      for (let i = 0; i < 9; i++) {
        const square = document.createElement('div');
        square.style.width = '100px';
        square.style.height = '100px';
        square.style.display = 'inline-block';
        square.style.margin = '5px';
        square.style.backgroundColor = i === oddPosition ? oddColor : mainColor;
        square.addEventListener('click', () => checkSquare(i));
        container.appendChild(square);
      }
      startTime = Date.now();  // Initialize startTime
      startTimer();
    };

    const showGameOver = () => {
      clearInterval(timer);
      document.getElementById('finalStreak').textContent = streak;
      document.getElementById('averageTime').textContent = calculateAverageTime();
      document.getElementById('slowestTime').textContent = slowestTime.toFixed(2);
      document.getElementById('gameOverScreen').style.display = 'block';
    };

    const restartGame = () => {
      streak = 0;
      updateStreakDisplay();
      initGameBoard();
      document.getElementById('gameOverScreen').style.display = 'none';
    };

    document.getElementById('restartButton').addEventListener('click', restartGame);

    const checkSquare = (index) => {
      const endTime = Date.now();
      const timeTaken = (endTime - startTime) / 1000;
      roundTimes.push(timeTaken);
      slowestTime = Math.max(slowestTime, timeTaken);

      if (index === oddPosition) {
        streak++;
        updateStreakDisplay();
        initGameBoard();
      } else {
        showGameOver();
      }
    };

    // Disable right-click context menu to prevent easy cheating
    document.addEventListener("contextmenu", (event) => {
      event.preventDefault();
    });

    initGameBoard();
  </script>
    <script src="../globalNav/globalNav.js" defer></script>
</body>

</html>
