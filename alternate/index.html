<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alternate</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap");

      body {
        font-family: "Montserrat", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background: linear-gradient(#f4f4f4, #ddd);
      }

      #title {
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      #gameArea {
        width: 300px;
        height: 300px;
        text-align: center;
        background-color: yellow;
        display: flex;
        align-items: center;
        justify-content: center;
        color: black;
        font-size: 24px;
        border-radius: 15px;
        padding: 10px;
        box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
        cursor: pointer;
      }

      #gameArea:hover {
        transform: scale(1.05);
      }

      #score,
      #reactionTime {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      #score {
        margin-top: 20px;
        font-size: 24px;
        font-weight: 700;
      }

      #reactionTime {
        margin-top: 10px;
        font-size: 20px;
      }

      #restart {
        margin-top: 10px;
        padding: 10px 20px;
        background-color: #333;
        color: #fff;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.3s ease;
        font-weight: 700;
      }

      #restart:hover {
        background-color: #555;
        transform: scale(1.05);
      }

      #restart:focus {
        outline: none;
      }
    </style>
    <meta
      name="description"
      content="Play Alternate, a fun and challenging reaction game. Test your reflexes and set new high scores. Join the PlayNerdle gaming community!"
    />
  </head>
  <body>
    <div id="navbar-container"></div>
    <p style="display: none">
      Welcome to Alternate, a reflex-based game where you test your reaction
      speed. Click when prompted and try to achieve the highest score possible.
      Can you beat the challenge?
    </p>
    <div id="title">Alternate</div>
    <div id="gameArea" onclick="userClicked()">Click to Start!</div>
    <div id="score">Score: 0</div>
    <div id="reactionTime">Time: 0s / 5s</div>
    <button id="restart" onclick="restartGame()">Restart</button>
    <script src="../globalNav/globalNav.js" defer></script>
    <script>
      let gameArea = document.getElementById("gameArea");
      let scoreDisplay = document.getElementById("score");
      let reactionTimeDisplay = document.getElementById("reactionTime");
      let restartButton = document.getElementById("restart");
      let isBlack = false;
      let isGameStarted = false;
      let isWaitingForClick = false;
      let startTime;
      let totalReactionTime = 0;
      let score = 0;
      let timeoutId;
      let timeInterval;
      let isGameOver = false;

      const titleElement = document.getElementById("title");
      const originalText = titleElement.textContent;

      let coloredText = "";
      let isYellow = true;

      for (let char of originalText) {
        if (char !== " ") {
          // Check if the character is not a space
          coloredText += `<span style="color:${
            isYellow ? "yellow" : "black"
          }">${char}</span>`;
          isYellow = !isYellow; // Toggle the color for the next character
        } else {
          coloredText += char; // Preserve the space without any color change
        }
      }

      titleElement.innerHTML = coloredText;

      // Get the high score from local storage
      let highScore = localStorage.getItem("alternatehighScore") || 0;

      function displayHighScore() {
        let currentScore = parseInt(scoreDisplay.textContent.split(": ")[1]);
        if (currentScore > highScore) {
          highScore = currentScore;
          localStorage.setItem("alternatehighScore", highScore);
          gameArea.textContent += "\nNew Record!";
        }
        scoreDisplay.textContent += `\nHigh Score: ${highScore}`;
      }

      // This function sets the text color based on the background color
      function setTextColorBasedOnBackground() {
        if (gameArea.style.backgroundColor === "black") {
          gameArea.style.color = "yellow";
        } else {
          gameArea.style.color = "black";
        }
      }

      function changeColor() {
        if (!isGameOver) {
          gameArea.textContent = ""; // Clear the "Click" text during the wait period
          let randomTime = (Math.random() * 1.5 + 0.5) * 1000;
          timeoutId = setTimeout(() => {
            isBlack = !isBlack;
            gameArea.style.backgroundColor = isBlack ? "black" : "yellow";
            setTextColorBasedOnBackground(); // Set the text color based on the background color
            gameArea.textContent = "Click";
            startTime = new Date().getTime();
            isWaitingForClick = true;
            timeInterval = setInterval(updateTimeDisplay, 50);
          }, randomTime);
        }
      }

      function getColorByPercentage(percentage) {
        if (percentage <= 50) {
          // Use #ddd until 50%
          return `linear-gradient(#f4f4f4 ${
            100 - percentage
          }%, #ddd ${percentage}%)`;
        } else {
          // Switch to #aaa after 50%
          return `linear-gradient(#f4f4f4 ${
            100 - percentage
          }%, #aaa ${percentage}%)`;
        }
      }

      function updateTimeDisplay() {
        let elapsed = new Date().getTime() - startTime;
        let totalTime = elapsed + totalReactionTime;
        let percentage = (totalTime / 5000) * 100;
        document.body.style.background = `linear-gradient(to top, #ddd ${percentage}%, #f4f4f4 ${percentage}%)`;
        reactionTimeDisplay.textContent = `Time: ${(totalTime / 1000).toFixed(
          2
        )}s / 5s`;
        if (totalTime >= 5000) {
          gameOver();
        }
      }

      function gameOver(reason) {
        mixpanel.track('Alternate score', {
  'test': score
})
        isGameOver = true;
        clearInterval(timeInterval);
        clearTimeout(timeoutId);

        gameArea.textContent = reason || "Game Over!";
        if (reason === "Clicked too soon!") {
          setTextColorBasedOnBackground(); // Ensuring the text color is set correctly for this message
        }

        isGameStarted = false;
        restartButton.style.display = "block";
        totalReactionTime = 5000;
        reactionTimeDisplay.textContent = `Time: 5s / 5s`;
        displayHighScore();
      }

      function userClicked() {
        if (isGameOver) return;
        if (!isGameStarted) {
          isGameStarted = true;
          gameArea.textContent = "";
          changeColor();
          return;
        }
        if (!isWaitingForClick) {
          totalReactionTime = 5000;
          reactionTimeDisplay.textContent = `Time: 5s / 5s`;
          gameOver("Clicked too soon!");
          return;
        }
        clearInterval(timeInterval);
        let reactionTime = new Date().getTime() - startTime;
        totalReactionTime += reactionTime;
        reactionTimeDisplay.textContent = `Time: ${(
          totalReactionTime / 1000
        ).toFixed(2)}s / 5s`;
        if (totalReactionTime >= 5000) {
          gameOver();
        } else {
          score++;
          scoreDisplay.textContent = "Score: " + score;
          isWaitingForClick = false;
          changeColor();
        }
      }

      function restartGame() {
        isGameOver = false;
        clearInterval(timeInterval);
        isBlack = false;
        totalReactionTime = 0;
        score = 0;
        scoreDisplay.textContent = "Score: 0";
        reactionTimeDisplay.textContent = "Time: 0s / 5s";
        restartButton.style.display = "none";
        gameArea.textContent = "Click to Start!"; // This line ensures the "Click to Start!" message is displayed.
        gameArea.style.backgroundColor = "yellow";
        isGameStarted = false;
        isWaitingForClick = false;
        clearTimeout(timeoutId);
      }
    </script>
  </body>
  <!-- Paste this right before your closing </head> tag -->
<script type="text/javascript">
  (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
  for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
  
  mixpanel.init('7f00bf62909510847bbbc30a1e8e2b26', { debug: true, track_pageview: true, persistence: 'localStorage' });

  
  </script>
</html>
